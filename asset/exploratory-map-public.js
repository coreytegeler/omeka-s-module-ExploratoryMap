!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("ExploratoryMap",[],t):"object"==typeof exports?exports.ExploratoryMap=t():e.ExploratoryMap=t()}(window,(function(){return function(e){var t={};function r(s){if(t[s])return t[s].exports;var i=t[s]={i:s,l:!1,exports:{}};return e[s].call(i.exports,i,i.exports,r),i.l=!0,i.exports}return r.m=e,r.c=t,r.d=function(e,t,s){r.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},r.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},r.t=function(e,t){if(1&t&&(e=r(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(r.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var i in e)r.d(s,i,function(t){return e[t]}.bind(null,i));return s},r.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return r.d(t,"a",t),t},r.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},r.p="",r(r.s=0)}({"./asset/src/exploratory-map-public.js":
/*!*********************************************!*\
  !*** ./asset/src/exploratory-map-public.js ***!
  \*********************************************/
/*! no static exports found */function(e,t,r){r(/*! ./exploratory-map-public.scss */"./asset/src/exploratory-map-public.scss");class s{constructor(e={}){this.options=Object.assign({selector:".exploratory-map-block",color:"#0dae0b"},e),this.markers=[],this.bounds=[],this.sources={},this.layers={},this.overlays={},this.block=document.querySelector(this.options.selector),this.block||console.warn('No element matched the selector "'+this.options.selector+'"'),this.container=this.block.querySelector(".map-container");let{basemap:t,accessToken:r}=this.block.dataset;this.block.removeAttribute("data-basemap"),this.block.removeAttribute("data-access-token"),this.forms=this.block.querySelectorAll(".layer-form"),mapboxgl.accessToken=r,this.map=new mapboxgl.Map({container:this.container,zoom:3}),this.map.on("load",this.handleMapLoad.bind(this)),this.map.on("style.load",this.handleStyleLoad.bind(this)),this.map.setStyle(t)}handleMapLoad(e){const t=this;this.map.on("mouseenter","markers",this.hoverMarker.bind(this)),this.map.on("mouseleave","markers",this.unhoverMarker.bind(this)),this.map.on("click","markers",this.clickMarker.bind(this)),this.block.querySelectorAll(".item").forEach((function(e,r){e.addEventListener("mousedown",t.clickItem.bind(t))})),this.block.querySelectorAll(".layer-form input").forEach((function(e,r){e.addEventListener("click",t.changeLayer.bind(t))}))}handleStyleLoad(e){Object.keys(this.layers).length?Object.keys(this.layers).forEach(e=>{if(!this.map.getSource(e)){const t=this.layers[e],r=this.sources[e],s=document.getElementById(e);s&&s.checked&&(t.layout.visibility="visible"),this.map.addSource(e,r),this.map.addLayer(t)}}):(this.addOverlays(),this.addMarkers())}changeLayer(e){const t=e.target,r=t.checked,s=t.parentElement,i=t.id,a=s.dataset.layerType,o=t.value;if("basemap"==a&&r&&this.map.setStyle(o),"overlay"==a&&Object.keys(this.overlays).forEach(e=>{this.overlays[e];i==e&&r?this.map.setLayoutProperty(e,"visibility","visible"):(document.getElementById(e).checked=!1,this.map.setLayoutProperty(e,"visibility","none"))}),"markers"==a){const e=s.querySelectorAll("input:checked"),t=Array.from(e).map(e=>e.value);this.map.setFilter("markers",["in","type"].concat(t))}}addOverlays(){const e=this;this.block.querySelectorAll("input[name='overlay']").forEach((function(t,r){let s=t.id,i=t.value,a=t.checked;if(!e.map.getSource(s+"")&&i){const r={type:"raster",url:t.value},i={id:s,source:s,type:"raster",layout:{visibility:a?"visible":"none"}};e.map.addSource(s,r),e.map.addLayer(i),e.overlays[s]=i,e.layers[s]=i,e.sources[s]=r}}))}addMarkers(){const e=this,t=this.block.dataset.markers,r=t?JSON.parse(t):null;if(this.block.removeAttribute("data-markers"),!r)return!1;this.sources.markers={type:"geojson",data:{type:"FeatureCollection",features:[]}};let s=new mapboxgl.LngLatBounds;r.forEach((function(t,r){let i=t.location,a=i["o-module-mapping:lat"],o=[i["o-module-mapping:lng"],a],n={type:"Feature",properties:{description:t.caption?t.caption:"",title:t.title?t.title:"",index:Number.isInteger(r)?r+1:"",item:t.item?t.item:"",type:t.type?t.type:""},geometry:{type:"Point",coordinates:o}};e.sources.markers.data.features.push(n),e.markers.push(n),e.getMarkerData(n,t),s.extend(o)})),this.sources["hover-markers"]=this.sources.markers,this.map.addSource("markers",this.sources.markers),this.map.addSource("hover-markers",this.sources["hover-markers"]);let i={id:"markers",type:"circle",source:"markers",paint:{"circle-color":this.options.color,"circle-radius":10,"circle-stroke-color":"rgba(255,255,255,.9)","circle-stroke-width":1.5}},a={id:"markers-hover",type:"symbol",source:"hover-markers",layout:{"text-field":"{title}","text-size":25,"text-font":["Open Sans Semibold","Arial Unicode MS Bold"],"text-offset":[0,.6],"text-anchor":"top"},paint:{"text-color":"#000000","text-halo-color":"rgba(255,255,255,.9)","text-halo-width":1.5},filter:["==","index",""]};this.map.addLayer(i),this.map.addLayer(a),this.layers.markers=i,this.layers["hover-markers"]=a,this.map.fitBounds(s,{padding:{top:100,bottom:100,left:100,right:100},animate:!1}),this.bounds=s,this.block.classList.add("loaded")}resetMap(){this.closePanel(),this.map.fitBounds(this.bounds,{padding:{top:100,bottom:100,left:100,right:100},animate:!0})}flyTo(e){const t=this,r=this.block.querySelector(".item.current"),s=r?r.dataset.index:null;if(r&&(r.classList.remove("current"),this.closePanel()),e&&parseInt(s)!==parseInt(e)){this.block.querySelector(".item[data-index='"+e+"']");let r=this.findItem(e),s=15,i=this.findPanel(e).offsetWidth+s,a=this.block.offsetWidth,o=a/2-(a-i)/2,n=r.dataset.markerCoords;if(r.classList.add("current"),n&&n.length){let r=JSON.parse(n);this.map.flyTo({center:r,speed:5,zoom:8}),this.map.once("moveend",(function(r){let s=t.map.getCenter();const i=t.map.project(s);i.x-=o,s=t.map.unproject(i),t.map.flyTo({center:s}),t.openPanel(e)}))}}else{let e=this.block.querySelector(".item.hidden");e&&e.classList.add("current")}}clickArrow(e){let t,r=e.target.getAttribute("data-direction"),s=this.block.querySelectorAll(".item"),i=this.block.querySelector(".item.current");if(i?"next"===r?t=i.nextElementSibling:"prev"===r&&(t=i.previousElementSibling):t=s[0],t){let e=t.dataset.index;this.flyTo(e)}else this.resetMap()}clickItem(e){let t=e.target;if(t){let e=t.dataset.index;this.flyTo(e)}}getMarkerData(e,t){const r=this,s=t.location["o:item"]["@id"];$.ajax({type:"GET",dataType:"json",url:s,success:function(t){r.populatePopup(e,t),r.populatePanel(e,t)},error:function(e,t,r){console.log(e,t,r)}})}populatePopup(e,t){let r=document.createElement("div");r.classList.add("map-popup"),r.dataset.index=e.properties.index;let s=document.createElement("h4");s.innerText=e.properties.title,r.appendChild(s),this.container.appendChild(r),this.block.querySelector(".item[data-index='"+e.properties.index+"']").classList.add("ready")}populatePanel(e,t){const r=document.createElement("div");r.classList.add("map-panel"),r.dataset.index=e.properties.index;const s=document.createElement("header"),i=document.createElement("h2");i.innerText=e.properties.title;const a=document.createElement("div");a.classList.add("map-arrow"),a.dataset.direction="prev",a.addEventListener("mousedown",this.clickArrow.bind(this));const o=document.createElement("div");o.classList.add("map-arrow"),o.dataset.direction="next",o.addEventListener("mousedown",this.clickArrow.bind(this));let n=document.createElement("div");n.classList.add("panel-inner"),n.appendChild(i.cloneNode(!0));let l=document.createElement("div");l.classList.add("panel-scroll");let c=document.createElement("div");c.classList.add("panel-properties"),s.appendChild(i),s.appendChild(a),s.appendChild(o),r.appendChild(s),n.appendChild(c),l.appendChild(n),r.appendChild(l),this.container.appendChild(r);[["alternative","Alt Title"],["date","Date"],["description","Description"],["references","Referenced Items"],["mediator","Media"]].forEach((function(e,r){let s=e[0],i=e[1],a=t["dcterms:"+s];if(a){let e=document.createElement("div");e.classList.add("panel-property"),e.classList.add(s),document.createElement("div").innerText=i,a.forEach((function(t,r){if("resource:item"===t.type){const r=t.display_title,s=t["@id"].replace("api","home").replace("items","item");let i=document.createElement("a");if(i.href=s,i.target="_blank","Mediator"===t.property_label){const e=t.thumbnail_url,r=document.createElement("img");r.src=e,i.appendChild(r)}else i.innerText=r;e.appendChild(i)}else e.innerText+=t["@value"]})),e&&c.appendChild(e)}})),n.appendChild(c)}hoverMarker(e){let t=e.features[0],r=t.properties.index;this.map.getCanvas().style.cursor="pointer",this.map.setFilter("markers-hover",["==","index",t.properties.index]),this.openPopup(r)}unhoverMarker(e){this.map.getCanvas().style.cursor="",this.map.setFilter("markers-hover",["==","index",""]),this.closePopup()}openPopup(e){let t=this.findPopup(e);t&&t.classList.add("show")}closePopup(){let e=this.container.querySelector(".map-popup.show");e&&e.classList.remove("show")}clickMarker(e){let t=e.features[0].properties.index;this.flyTo(t)}openPanel(e){const t=this,r=this.findPanel(e);r.classList.add("show"),setTimeout((function(){t.map.once("click",(function(e){r.classList.remove("show")}))}))}closePanel(){let e=this.findPanel();e&&e.classList.remove("show");let t=this.findItem();t&&t.classList.remove("current")}findPanel(e){let t;return e&&(t=this.container.querySelector(".map-panel[data-index='"+e+"']")),t||(t=this.container.querySelector(".map-panel.show"),t||!1)}findPopup(e){let t=this.container.querySelector(".map-popup[data-index='"+e+"']");return!(!t||!t.length)&&t}findItem(e){let t=this.block.querySelector(".item[data-index='"+e+"']");return t||(t=this.block.querySelector(".item.current"),t||!1)}findMarker(e,t){}}window.onload=function(){new s({})}},"./asset/src/exploratory-map-public.scss":
/*!***********************************************!*\
  !*** ./asset/src/exploratory-map-public.scss ***!
  \***********************************************/
/*! no static exports found */function(e,t,r){},0:
/*!***************************************************!*\
  !*** multi ./asset/src/exploratory-map-public.js ***!
  \***************************************************/
/*! no static exports found */function(e,t,r){e.exports=r(/*! /Users/coreytegeler/Sites/mct.barnard.edu/modules/ExploratoryMap/asset/src/exploratory-map-public.js */"./asset/src/exploratory-map-public.js")}})}));